<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>åŠ¨æ€å½©äº‘å¤©æ°”ï¼ˆæŒ‰æœç´¢/å®šä½åŸå¸‚å®æ—¶èƒŒæ™¯ï¼‰</title>
<style>
  html,body{margin:0;padding:0;height:100%;font-family:"Segoe UI",sans-serif;color:#333;overflow-x:hidden}
  body{position:relative;transition:background 0.6s ease}
  canvas{position:fixed;top:0;left:0;z-index:-1}
  .container{max-width:900px;margin:auto;padding:20px}
  .card{background:rgba(255,255,255,0.85);border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 8px 20px rgba(0,0,0,0.1)}
  .title{font-size:1.5em;font-weight:bold;margin-bottom:10px}
  .weather-main{display:flex;justify-content:space-between;align-items:center}
  .weather-temp{font-size:2.5em;font-weight:bold}
  .forecast{display:flex;overflow-x:auto;gap:10px}
  .forecast-item{flex:0 0 auto;background:rgba(255,255,255,0.9);border-radius:10px;padding:10px;text-align:center;width:100px;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
  #city-error{color:#d9534f;margin-top:5px;font-size:14px;display:none}
</style>
</head>
<body>
<canvas id="weatherCanvas"></canvas>

<div class="container">
  <div class="card" id="location-card">
    <div class="title">å½“å‰ä½ç½®</div>
    <div id="location">æ­£åœ¨è·å–å®šä½...</div>
    <div style="margin-top:15px;">
      <div style="display:flex;gap:10px;align-items:center;">
        <input id="city-input" type="text" placeholder="è¯·è¾“å…¥åŸå¸‚åç§°" style="padding:8px;flex:1;border:1px solid #ddd;border-radius:5px">
        <button id="search-city" style="padding:8px 15px;background:#4facfe;color:#fff;border:none;border-radius:5px">æŸ¥è¯¢</button>
      </div>
      <p id="city-error">é”™è¯¯ä¿¡æ¯</p>
    </div>
  </div>

  <div class="card">
    <div class="title">å®æ—¶å¤©æ°”</div>
    <div class="weather-main">
      <div>
        <div id="temp" class="weather-temp">--Â°C</div>
        <div id="desc">--</div>
      </div>
      <div id="icon" style="font-size:48px">â˜€ï¸</div>
    </div>
  </div>

  <div class="card">
    <div class="title">æœªæ¥48å°æ—¶</div>
    <div id="hourly" class="forecast"></div>
  </div>

  <div class="card">
    <div class="title">æœªæ¥3å¤©</div>
    <div id="daily" class="forecast"></div>
  </div>
</div>

<script>
/* ====== é…ç½®ï¼ˆä¿æŒä½ åŸæœ‰çš„ keyï¼‰ ====== */
const API_KEY = "0nRahTS8MYHrujeP"; // å½©äº‘å¤©æ°” API keyï¼ˆjsonpï¼‰
const GAODE_API_KEY = "bd5388dfef81ab0f12b81ff9d179b61b"; // é«˜å¾· key

/* ====== ç”»å¸ƒä¸çŠ¶æ€ ====== */
const canvas = document.getElementById('weatherCanvas');
const ctx = canvas.getContext('2d');
let particles = [];               // æ‰€æœ‰ç²’å­
let _lightningInterval = null;    // é—ªç”µå®šæ—¶å™¨
let _lightningFlash = 0;          // é—ªç”µé—ªçš„å¸§æ•°è®¡æ•°
let _lastWeatherScriptId = null;  // ç”¨äºæ¸…ç† jsonp script
let _currentWeatherCity = '';     // å½“å‰è¯·æ±‚å¯¹åº”çš„åŸå¸‚åï¼ˆç”¨äºæ˜¾ç¤ºä¸åˆ¤æ–­ï¼‰
resizeCanvas();

window.addEventListener('resize', resizeCanvas);
function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

/* ====== åŠ¨ç”» helpers ====== */
function clearEffects(){
  particles = [];
  if (_lightningInterval) { clearInterval(_lightningInterval); _lightningInterval = null; }
  _lightningFlash = 0;
}

/* å„ç±»ç²’å­ç”Ÿæˆå™¨ï¼ˆé›¨ã€é›ªã€å…‰æ–‘ã€äº‘ç­‰ï¼‰ */
function createRain(count=150){
  for(let i=0;i<count;i++){
    particles.push({type:'rain', x:Math.random()*canvas.width, y:Math.random()*canvas.height, len:Math.random()*20+12, speed:Math.random()*4+6, alpha: Math.random()*0.4+0.4});
  }
}
function createSnow(count=100){
  for(let i=0;i<count;i++){
    particles.push({type:'snow', x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*3+1, speed:Math.random()*0.6+0.3});
  }
}
function createSnowGlow(count=24){
  for(let i=0;i<count;i++){
    particles.push({type:'snowglow', x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*4+3, speed:Math.random()*0.4+0.1});
  }
}
function createFloatingLights(count=50){
  for(let i=0;i<count;i++){
    particles.push({type:'light', x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.8+0.8, speed:Math.random()*0.4+0.1, alpha: Math.random()*0.6+0.3});
  }
}
function createClouds(count=8){
  for(let i=0;i<count;i++){
    particles.push({type:'cloud', x:Math.random()*canvas.width, y:Math.random()*canvas.height*0.6, r:Math.random()*80+60, speed:(Math.random()*0.3+0.05), alpha: Math.random()*0.25+0.15});
  }
}

/* é—ªç”µï¼šä¸ç›´æ¥ç»˜åˆ¶çŸ©å½¢é—ªï¼Œè€Œæ˜¯è§¦å‘çŸ­æ—¶çš„å…¨å±ç™½å…‰ï¼ˆæ›´å¯æ§ï¼‰ */
function createLightning(){
  if (_lightningInterval) clearInterval(_lightningInterval);
  _lightningInterval = setInterval(()=>{
    // éšæœºåŒ–é—´éš”
    _lightningFlash = Math.floor(3 + Math.random()*5); // é—ªå‡ å¸§
  }, 2500 + Math.random()*3500);
}

/* æ ¹æ® skycon å’ŒåŸå¸‚å†³å®šæ•ˆæœï¼ˆcityName å¯ç”¨äºç‰¹æ•ˆåŠ å¼ºï¼‰ */
function setBackgroundEffect(skycon = "", cityName = ""){
  clearEffects();
  skycon = (skycon || "").toUpperCase();
  cityName = cityName || "";
  // ä¸€èˆ¬ç‰¹æ•ˆ
  if(skycon.includes("RAIN")){
    createRain(160);
    createClouds(6);
    createLightning();
  } else if(skycon.includes("SNOW")){
    createSnow(120);
    createSnowGlow(28);
    createClouds(5);
  } else if(skycon.includes("CLEAR")){
    createFloatingLights(60);
    // æ™´å¤©ä¹Ÿåšè½»å¾®äº‘å±‚ä»¥å¢åŠ å±‚æ¬¡
    createClouds(4);
  } else if(skycon.includes("CLOUD")){
    createClouds(10);
  } else {
    // é»˜è®¤è½»å¾®äº‘
    createClouds(6);
  }
  // åŸå¸‚ç‰¹æ®ŠåŠ å¼ºï¼ˆå¦‚æœä½ æƒ³åŒ—äº¬æœ‰æ›´å¼ºæ•ˆæœï¼Œå¯åœ¨æ­¤åˆ¤æ–­ï¼‰
  if(/åŒ—äº¬/.test(cityName)){
    // åŒ—äº¬ï¼šåœ¨æ™´å¤©æ·»åŠ æ›´å¤šå…‰æ–‘ï¼›é›¨å¤©å¢åŠ äº‘å±‚å¯†åº¦
    if(skycon.includes("CLEAR")) createFloatingLights(40);
    if(skycon.includes("RAIN")) createClouds(10);
  }
}

/* èƒŒæ™¯é¢œè‰²ï¼ˆæ¢¯åº¦ï¼‰ */
function setBackgroundColor(skycon = ""){
  const map = {
    "CLEAR_DAY":"linear-gradient(to bottom,#4facfe,#00f2fe)",
    "CLEAR_NIGHT":"linear-gradient(to bottom,#0f2027,#203a43)",
    "PARTLY_CLOUDY_DAY":"linear-gradient(to bottom,#a1c4fd,#c2e9fb)",
    "PARTLY_CLOUDY_NIGHT":"linear-gradient(to bottom,#2c3e50,#4ca1af)",
    "CLOUDY":"linear-gradient(to bottom,#cfd9df,#e2ebf0)",
    "RAIN":"linear-gradient(to bottom,#00c6fb,#005bea)",
    "SNOW":"linear-gradient(to bottom,#e0f7ff,#f7fbff)"
  };
  document.body.style.background = map[skycon] || "linear-gradient(to bottom,#a0cfff,#ffffff)";
}

/* åŠ¨ç”»ä¸»å¾ªç¯ï¼šä¾æ®ç²’å­ç±»å‹ç»˜åˆ¶ */
function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // é—ªç”µé—ªçƒè¦†ç›–å±‚ï¼ˆä¼˜å…ˆï¼‰
  if(_lightningFlash > 0){
    ctx.fillStyle = `rgba(255,255,255,${0.14 + Math.random()*0.26})`;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    _lightningFlash--;
  }

  for(let p of particles){
    if(p.type === 'rain'){
      ctx.beginPath();
      ctx.strokeStyle = `rgba(174,194,224,${p.alpha})`;
      ctx.lineWidth = 1;
      ctx.moveTo(p.x, p.y);
      ctx.lineTo(p.x, p.y + p.len);
      ctx.stroke();
      p.y += p.speed;
      p.x += Math.sin(p.y/20)*0.6;
      if(p.y > canvas.height + p.len) {
        p.y = -p.len;
        p.x = Math.random()*canvas.width;
      }
    } else if(p.type === 'snow'){
      ctx.beginPath();
      ctx.fillStyle = "rgba(255,255,255,0.9)";
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
      p.y += p.speed;
      p.x += Math.sin(p.y/30)*0.3;
      if(p.y > canvas.height + p.r) { p.y = -p.r; p.x = Math.random()*canvas.width; }
    } else if(p.type === 'snowglow'){
      ctx.save();
      ctx.beginPath();
      ctx.shadowColor = "white";
      ctx.shadowBlur = 12;
      ctx.fillStyle = "rgba(255,255,255,0.95)";
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
      p.y += p.speed;
      if(p.y > canvas.height + p.r) { p.y = -p.r; p.x = Math.random()*canvas.width; }
    } else if(p.type === 'light'){
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,200,${p.alpha})`;
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
      p.y += p.speed;
      p.x += Math.sin(p.y/60)*0.2;
      if(p.y > canvas.height + p.r) { p.y = -p.r; p.x = Math.random()*canvas.width; }
    } else if(p.type === 'cloud'){
      ctx.save();
      ctx.globalAlpha = p.alpha;
      ctx.beginPath();
      // ç”»ä¸€ä¸ªæ¤­åœ†çŠ¶çš„äº‘
      const rx = p.r * 1.6;
      const ry = p.r;
      ctx.ellipse(p.x, p.y, rx, ry, 0, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(255,255,255,0.85)';
      ctx.fill();
      ctx.restore();
      p.x += p.speed;
      if(p.x - p.r*2 > canvas.width) p.x = -p.r*2;
    }
  }

  requestAnimationFrame(animate);
}
animate();

/* ====== JSONP è¯·æ±‚ä¸å›è°ƒç®¡ç† ====== */
/* ä½¿ç”¨å…¨å±€ _currentWeatherCity æ¥æ ‡è®°å½“å‰è¯·æ±‚çš„åŸå¸‚åï¼Œä»¥ä¾¿ MYCALLBACK èƒ½çŸ¥é“æ˜¯å“ªæ¬¡è¯·æ±‚ */
function fetchWeather(lat, lon, cityName = ""){
  // lat, lon: numbers or strings (lat = latitude, lon = longitude)
  // æ¸…ç†ä¸Šä¸€æ¬¡ jsonp script
  if(_lastWeatherScriptId){
    const old = document.getElementById(_lastWeatherScriptId);
    if(old) old.remove();
    _lastWeatherScriptId = null;
  }
  _currentWeatherCity = cityName || "";
  const id = 'caiyun-jsonp-' + Date.now();
  _lastWeatherScriptId = id;
  const script = document.createElement('script');
  script.id = id;
  // å½©äº‘ JSONP æ¥å£è¦æ±‚ç»åº¦,çº¬åº¦ï¼ˆlon,latï¼‰
  script.src = `https://api.caiyunapp.com/v2.6/${API_KEY}/${lon},${lat}/weather.jsonp?callback=MYCALLBACK`;
  script.onerror = () => {
    console.error('åŠ è½½å¤©æ°” JSONP å¤±è´¥');
    document.getElementById('city-error').textContent = 'å¤©æ°”æ•°æ®åŠ è½½å¤±è´¥';
    document.getElementById('city-error').style.display = 'block';
  };
  document.body.appendChild(script);
}

/* å…¨å±€å›è°ƒï¼ˆå½©äº‘ JSONP ä¼šè°ƒç”¨ï¼‰ */
function MYCALLBACK(data){
  // åˆ é™¤ä¸Šæ¬¡ jsonp scriptï¼ˆé˜²æ­¢å †ç§¯ï¼‰
  if(_lastWeatherScriptId){
    const s = document.getElementById(_lastWeatherScriptId);
    if(s) s.remove();
    _lastWeatherScriptId = null;
  }

  if(!data || !data.result){
    console.warn('å¤©æ°”è¿”å›å¼‚å¸¸', data);
    document.getElementById('city-error').textContent = 'å¤©æ°”æ•°æ®å¼‚å¸¸';
    document.getElementById('city-error').style.display = 'block';
    return;
  }

  // è§£æ
  const realtime = data.result.realtime || {};
  const hourly = data.result.hourly || {};
  const daily = data.result.daily || {};

  // æ˜¾ç¤ºåŸºç¡€å®æ—¶å¤©æ°”
  const tempEl = document.getElementById('temp');
  const descEl = document.getElementById('desc');
  const iconEl = document.getElementById('icon');
  tempEl.textContent = (realtime.temperature !== undefined) ? `${realtime.temperature}Â°C` : '--Â°C';
  const skycon = (realtime.skycon || '').toUpperCase();
  descEl.textContent = skyconToChinese(skycon);
  iconEl.textContent = skyconEmoji(skycon);

  // èƒŒæ™¯é¢œè‰²ä¸ç‰¹æ•ˆï¼ˆä½¿ç”¨ _currentWeatherCity æ¥å†³å®šæ˜¯å¦éœ€è¦åŸå¸‚çº§çš„ç‰¹æ®Šå¤„ç†ï¼‰
  setBackgroundColor(skycon);
  setBackgroundEffect(skycon, _currentWeatherCity);

  // å¡«å……å°æ—¶ä¸æ—¥é¢„æŠ¥ï¼ˆå®¹é”™ï¼‰
  const hourlyDiv = document.getElementById('hourly');
  hourlyDiv.innerHTML = '';
  if(hourly.temperature && hourly.temperature.length){
    // ç¡®ä¿æŒ‰é•¿åº¦å¾ªç¯ï¼Œé¿å…ç´¢å¼•è¶Šç•Œ
    const len = Math.min(hourly.temperature.length, (hourly.skycon && hourly.skycon.length) ? hourly.skycon.length : hourly.temperature.length);
    for(let i=0;i<len;i++){
      const tObj = hourly.temperature[i];
      const timeStr = tObj && tObj.datetime ? new Date(tObj.datetime).getHours() + 'æ—¶' : (i + 'h');
      const tVal = tObj && (tObj.value !== undefined) ? `${tObj.value}Â°C` : '--';
      const skyVal = (hourly.skycon && hourly.skycon[i] && hourly.skycon[i].value) ? hourly.skycon[i].value : '';
      const div = document.createElement('div');
      div.className = 'forecast-item';
      div.innerHTML = `<div>${timeStr}</div><div>${skyconEmoji(skyVal)}</div><div>${tVal}</div><div style="font-size:12px">${skyconToChinese(skyVal)}</div>`;
      hourlyDiv.appendChild(div);
    }
  } else {
    hourlyDiv.innerHTML = '<div class="forecast-item">æ— å°æ—¶æ•°æ®</div>';
  }

  const dailyDiv = document.getElementById('daily');
  dailyDiv.innerHTML = '';
  if(daily.temperature && daily.temperature.length){
    const len = Math.min(daily.temperature.length, (daily.skycon && daily.skycon.length) ? daily.skycon.length : daily.temperature.length);
    for(let i=0;i<len;i++){
      const tObj = daily.temperature[i];
      const dateStr = tObj && tObj.date ? new Date(tObj.date).toLocaleDateString() : ('ç¬¬' + (i+1) + 'å¤©');
      const tMax = tObj && (tObj.max !== undefined) ? tObj.max : '--';
      const tMin = tObj && (tObj.min !== undefined) ? tObj.min : '--';
      const skyVal = (daily.skycon && daily.skycon[i] && daily.skycon[i].value) ? daily.skycon[i].value : '';
      const div = document.createElement('div');
      div.className = 'forecast-item';
      div.innerHTML = `<div>${dateStr}</div><div>${skyconEmoji(skyVal)}</div><div>${tMax} / ${tMin}Â°C</div><div style="font-size:12px">${skyconToChinese(skyVal)}</div>`;
      dailyDiv.appendChild(div);
    }
  } else {
    dailyDiv.innerHTML = '<div class="forecast-item">æ— æ—¥æ•°æ®</div>';
  }
}

/* ====== skycon è¾…åŠ©å‡½æ•° ====== */
function skyconEmoji(skycon){
  if(!skycon) return 'â€”';
  const map = {
    'CLEAR_DAY':'â˜€ï¸','CLEAR_NIGHT':'ğŸŒ™',
    'PARTLY_CLOUDY_DAY':'â›…','PARTLY_CLOUDY_NIGHT':'â˜ï¸',
    'CLOUDY':'â˜ï¸','RAIN':'ğŸŒ§ï¸','SNOW':'â„ï¸','HAZE':'ğŸŒ«ï¸','LIGHT_RAIN':'ğŸŒ¦ï¸'
  };
  return map[skycon] || 'â˜€ï¸';
}
function skyconToChinese(skycon){
  if(!skycon) return 'æœªçŸ¥';
  const map = {
    'CLEAR_DAY':'æ™´å¤©','CLEAR_NIGHT':'æ™´(å¤œ)',
    'PARTLY_CLOUDY_DAY':'å¤šäº‘','PARTLY_CLOUDY_NIGHT':'å¤šäº‘(å¤œ)',
    'CLOUDY':'é˜´å¤©','RAIN':'é™é›¨','SNOW':'é™é›ª','HAZE':'é›¾éœ¾'
  };
  return map[skycon] || skycon;
}

/* ====== åŸå¸‚å <-> åæ ‡ï¼ˆé«˜å¾·ï¼‰ ====== */
/* é€šè¿‡åŸå¸‚åè·å–ç»çº¬åº¦ï¼ˆé«˜å¾·åœ°ç†ç¼–ç ï¼‰ï¼Œå¹¶è°ƒç”¨ fetchWeather */
function getLocationByCity(cityName){
  cityName = (cityName || '').trim();
  if(!cityName){
    document.getElementById('city-error').textContent = 'è¯·è¾“å…¥æœ‰æ•ˆåŸå¸‚åç§°';
    document.getElementById('city-error').style.display = 'block';
    return;
  }
  document.getElementById('city-error').style.display = 'none';
  document.getElementById('location').textContent = `æ­£åœ¨è·å– ${cityName} çš„ä½ç½®ä¿¡æ¯...`;
  const url = `https://restapi.amap.com/v3/geocode/geo?key=${GAODE_API_KEY}&address=${encodeURIComponent(cityName)}`;
  fetch(url).then(r=>r.json()).then(data=>{
    if(data && data.status === '1' && data.geocodes && data.geocodes.length>0){
      // geocodes[0].location => "lng,lat"
      const loc = data.geocodes[0].location || '';
      const [lng,lat] = loc.split(',');
      document.getElementById('location').textContent = `åŸå¸‚: ${cityName}`;
      // ç¡®ä¿æŒ‰ (lat, lon) ä¼ å…¥
      fetchWeather(lat, lng, cityName);
    } else {
      document.getElementById('city-error').textContent = `æœªæ‰¾åˆ° ${cityName} çš„ä½ç½®ä¿¡æ¯`;
      document.getElementById('city-error').style.display = 'block';
      document.getElementById('location').textContent = 'å®šä½å¤±è´¥';
    }
  }).catch(err=>{
    console.error('é«˜å¾·åœ°ç†ç¼–ç å¤±è´¥', err);
    document.getElementById('city-error').textContent = 'è·å–ä½ç½®ä¿¡æ¯å¤±è´¥';
    document.getElementById('city-error').style.display = 'block';
    document.getElementById('location').textContent = 'å®šä½å¤±è´¥';
  });
}

/* é€šè¿‡ç»çº¬åº¦åå‘è§£æåŸå¸‚åï¼ˆç”¨äºå®šä½æˆåŠŸæ—¶æ˜¾ç¤ºåŸå¸‚åï¼‰ */
function reverseGeocodeAndFetch(lat, lon){
  const url = `https://restapi.amap.com/v3/geocode/regeo?key=${GAODE_API_KEY}&location=${lon},${lat}`;
  fetch(url).then(r=>r.json()).then(data=>{
    let city = '';
    try{
      const comp = data.regeocode && data.regeocode.addressComponent;
      if(comp){
        // comp.city å¯èƒ½ä¸ºç©ºä¸²æˆ–æ•°ç»„/å­—ç¬¦ä¸²
        city = comp.city || comp.province || '';
        // city å¯èƒ½æ˜¯ [] (ç©ºæ•°ç»„), ä¹Ÿå¯èƒ½æ˜¯ ''ï¼Œè‹¥ä¸ºæ•°ç»„å–ç¬¬ä¸€ä¸ª
        if(Array.isArray(city)) city = city[0] || '';
        // æœ‰æ—¶ comp.city è¿”å› "" è€Œ comp.province æœ‰çœåï¼Œå°è¯•ä½¿ç”¨åŒº/é•‡è¡¥å……
        if(!city && comp.township) city = comp.township;
      }
    }catch(e){ city = ''; }
    if(city) document.getElementById('location').textContent = `åŸå¸‚: ${city}`;
    else document.getElementById('location').textContent = 'å½“å‰ä½ç½®';
    fetchWeather(lat, lon, city);
  }).catch(err=>{
    console.warn('åå‘åœ°ç†ç¼–ç å¤±è´¥', err);
    document.getElementById('location').textContent = 'å½“å‰ä½ç½®';
    fetchWeather(lat, lon);
  });
}

/* ====== å®šä½é€»è¾‘ ====== */
function getUserLocation(){
  if(!navigator.geolocation){
    document.getElementById('location').textContent = 'æ— æ³•è·å–ä½ç½®ï¼Œæ˜¾ç¤ºåŒ—äº¬å¤©æ°”';
    getLocationByCity('åŒ—äº¬');
    return;
  }
  navigator.geolocation.getCurrentPosition(pos=>{
    // ä¸åœ¨é¡µé¢æ˜¾ç¤ºç»çº¬åº¦ï¼ˆæŒ‰éœ€æ±‚ï¼šéšè—ç»çº¬åº¦ï¼Œæ˜¾ç¤ºåŸå¸‚åï¼‰
    const lat = pos.coords.latitude.toFixed(6);
    const lon = pos.coords.longitude.toFixed(6);
    // ç”¨é«˜å¾·åå‘åœ°ç†ç¼–ç è·å–åŸå¸‚åå¹¶ fetchWeatherï¼ˆèƒŒæ™¯ä¼šæ ¹æ®è¿”å›çš„å¤©æ°”åŠ¨æ€å˜åŒ–ï¼‰
    reverseGeocodeAndFetch(lat, lon);
  }, err=>{
    console.warn('å®šä½å¤±è´¥æˆ–è¢«æ‹’ç»ï¼š', err);
    document.getElementById('location').textContent = 'å®šä½å¤±è´¥ï¼Œæ˜¾ç¤ºåŒ—äº¬å¤©æ°”';
    getLocationByCity('åŒ—äº¬');
  }, {enableHighAccuracy:true, timeout:5000, maximumAge:0});
}

/* æŒ‰é’® / å›è½¦äº‹ä»¶ */
document.getElementById('search-city').addEventListener('click', ()=>{
  getLocationByCity(document.getElementById('city-input').value);
});
document.getElementById('city-input').addEventListener('keypress',(e)=>{
  if(e.key === 'Enter') getLocationByCity(document.getElementById('city-input').value);
});

/* å¯åŠ¨å®šä½ -> å¤©æ°”åŠ è½½ */
getUserLocation();
</script>
</body>
</html>
